\input{compos.pre}
\newcommand{\subseqof}{\sqsubseteq}
\newcommand{\prefixof}{\leqslant}
\newcommand{\suffixof}{\geqslant}
\psset{linecolor=darkGreen,linewidth=0.5pt}


\author{William Blum}
\title{P-incrementally justified strategies}

\begin{document}
\maketitle 

\section{Well-bracketing and incremental-justification}

We consider an arena $A$ and make the following two assumptions on it:
\begin{itemize}
\item (A1) For $A \neq \bot$ (the arena with a single initial question), each question move in the arena enables at least one answer move.
\item (A2) Answer moves do not enable any other move.
\end{itemize}

We define the \defname{order} of a move $m$, written $\ord{m}$, as
the length of the path from $m$ to its furthest leaf in the arena minus 1
({\it i.e.}~the height of the subarena rooted at $m$ minus 2.).
Because of assumptions (A1) and (A2),
for any move $m$ of $A \neq \bot$, $m$ is question move if and only if $\ord{m} \geq 0$, and $m$ is an answer move if and only if $\ord{m} = -1$.





We call \defname{pending question} of a sequence of moves $s \in L_A$ the last unanswered question in $s$.

\begin{definition}\rm
A strategy $\sigma$ is said to be \defname{P-well-bracketed} if for any play $s \, a \in \sigma$ where $a$ is a  P-answer, $a$ points to the pending question in $s$.
\end{definition}



P-well-bracketing can be restated differently as the following proposition shows:
\begin{proposition}
\label{prop:char_wellbrack}
\rm We make assumption (A1) and (A2).
Let $\sigma$ be a strategy on an arena $A\neq \bot$.
The following statements are equivalent:
\begin{enumerate}
\item[(i)] $\sigma$ is P-well-bracketed,
\item[(ii)] for $s \, a \in \sigma$ with $a$ a P-answer, $a$ points to the pending question in $\pview{s}$,
\item[(iii)] for $s \, a \in \sigma$ with $a$ a P-answer, $a$ points to the last O-question in $\pview{s}$,
\item[(iv)] for $s \, a \in \sigma$ with $a$ a P-answer, $a$ points to the last O-move in $\pview{s}$ with order $>\ord{a}$.
\end{enumerate}
\end{proposition}
\begin{proof}
$(i)\iff(ii)$: \cite[Lemma 2.1]{McC96b} states that if P is to move then the pending question in $s$ is the same as that of $\pview{s}$.

$(ii)\iff(iii)$: Assumption (A2) implies that the pending question in $\pview{s}$ is also the last O-question occurring in $\pview{s}$.

$(iii)\iff(iv)$: Because of assumption (A1) and (A2),
for any move $m$, we have $m$ is a question move
if and only if $\ord{m} \geq 0$ if and only if $\ord{m} > \ord{a} = -1$.
\end{proof}




\begin{lemma}
\label{lem:justfied_by_unanswered}
Under assumption (A2), if $s$ be a justified sequence of moves satisfying alternation and visibility then any O-move (resp. P-move) in $s$ points to an \emph{unanswered} P question (resp. O-question).
\end{lemma}
\begin{proof}
Suppose that an O-move $c$ points to a P-move $d$ that has already been answered by the O-move $a$. The sequence $s$ as the following form:
$$ s= \ldots \Pstr{(d){d}  \ldots  (a-d,20){a}  \ldots  (c-d,20){c}}$$

By O-visibility, $d$ must belong to $\oview{s_{<c}}$. But since $a$ is an answer, by assumption (A2), it cannot justify any P-move, therefore
$\oview{s_{<q}}$ must contain an OP-arc ``hoping'' over $a$. We name the nodes of this arc $d^1$ and $c^1$:
$$ s = \ldots \Pstr[0.7cm]{(d){d}  \ldots  (d1){d^1} \ldots (a-d,20){a} \ldots
 (c1-d1,20){c^1} \ldots (c-d,25){c}}$$

By P-visibility, $d^1$ must belong to $\pview{s_{<c^1}}$. Consequently, $a$ does not belong to $\pview{s_{<c^1}}$ (otherwise the PO-arc $\Pstr[0.5cm]{(d){d} \quad (a-d,45){a}}$ would cause the P-view to jump over $d^1$).
Therefore there must be a PO-arc $\Pstr[0.5cm]{(d2){d^2} \quad (c2-d2,45){c^2}}$ in $\pview{s_{<c^1}}$ hoping over $a$:
$$ s = \ldots \Pstr[0.7cm]{(d){d}  \ldots
(d1){d^1} \ldots (d2){c^2} \ldots
(a-d,20){a} \ldots
 (c2-d2,20){d^2} \ldots (c1-d1,20){c^1} \ldots (c-d,25){c}}$$

This process can be repeated infinitely often by using alternatively O-visibility and P-visibility. This gives a contradiction since the sequence of moves $s_{<c}$ has finite length.
Hence $d$ cannot point to a question that has already been answered. Since, by assumption (A2), a question is enabled by another question, $d$ is necessarily justified by an unanswered question.
\end{proof}


\begin{lemma}
\label{lem:oq_in_pview_unanswered}
Under assumption (A2), if $s$ is a P-well-bracketed justified sequence of moves of odd length satisfying alternation and visibility then  all O-questions occurring in $\pview{s}$ are unanswered in $s$.
\end{lemma}
\begin{proof}
We proof the first part by induction on $s$.
The base case ($s = q$ with $q$ initial O-move) is trivial.

Suppose $\Pstr[0.4cm]{ s = s' \cdot (n)n \cdot u \cdot (m-n,45){m} }$.
Let $r$ be an O-question in $\pview{s} = \pview{s'} \cdot n \cdot m$.
If $r$ is the last move $m$ then it is necessarily unanswered.
If $r \in \pview{s'}$ then by the induction hypothesis, $r$ is unanswered in $s'$.
Suppose that $r$ is answered in $s$. This implies that some answer move $a$ in $u$ points to $r$:
$$\pstr[0.7cm][5pt]{ s = \underbrace{\cdots\ \nd(r){r}^O \cdots }_{s'} \
\nd(n){n}^P \ \underbrace{\cdots\ \nd(a-r,35){a}^P \cdots }_{u} \
\nd(m-n,30){m}^O } \ .$$
 
Since $m$ points to $n$, by lemma \ref{lem:justfied_by_unanswered}, $n$ is still unanswered at $s_{\prefixof a}$. Therefore the pending
question at $s_{\prefixof a}$ cannot be $r$. But $a$ is justified by $r$, therefore the well-bracketing condition is violated. Hence $r$ is
unanswered in $s$.
\end{proof}





\begin{definition}\rm
  A strategy $\sigma$ is said to be \defname{P-incrementally
    justified} if for any play $s \, q \in \sigma$ where $q$ is a
  P-question, $q$ points to the last unanswered O-question in $\pview{s}$ with
  order strictly greater than $\ord{q}$.
\end{definition}

\begin{proposition}
\label{prop:char_pincr}
\rm We make assumption (A1) and (A2).
Let $\sigma$ be a \emph{P-well-bracketed} strategy on an arena $A\neq \bot$.
The following statements are equivalent:
\begin{enumerate}
\item[(i)] $\sigma$ is P-incrementally-justified,
\item[(ii)] for $s \, q \in \sigma$ with $q$ a P-question, $q$ points to the last O-question in $\pview{s}$ with order $>\ord{q}$,
\item[(iii)] for $s \, q \in \sigma$ with $q$ a P-question, $q$ points to the last O-move in $\pview{s}$ with order $>\ord{q}$.
\end{enumerate}
\end{proposition}
\begin{proof}
$(i)\iff(ii)$: By lemma \ref{lem:oq_in_pview_unanswered}, O-question occurring in $\pview{s}$ are all unanswered.

$(ii)\iff(iii)$: Because of (A1) and (A2), $\ord{q} \geq 0$ thus an O-move with order $>\ord{q}$ is necessarily an O-question.
\end{proof}

Putting proposition \ref{prop:char_pincr} and
\ref{prop:char_wellbrack} together we obtain:
\begin{proposition}
Under assumption (A1) and (A2).
A strategy $\sigma$ on $A\neq \bot$
is \emph{P-well-bracketed} and
 \emph{P-incrementally-justified} if and only if
for $s \, m \in \sigma$, $m$ points to the last O-move in $\pview{s}$ with order $>\ord{m}$.
\end{proposition}


\section{Remarks}
\subsection{Homogeneity constraint}

Type homogeneity is not preserved after composition. Indeed the types  $o \longrightarrow (o \rightarrow o)$ and $(o \rightarrow o) \longrightarrow \left((o \rightarrow o) \rightarrow o \right)$ are homogeneous
but $o \longrightarrow \left((o \rightarrow o) \rightarrow o\right)$ is not.

If $A\rightarrow B$ and $B \rightarrow C$ are homogeneous then 
as sufficient condition for $A\rightarrow C$ to be homogeneous is to have $\ord{A} \geq \ord{B}$.


\section{Compositionality - semantic approach}

\subsection{Preliminaries}
 
\subsubsection{Nodes order after composition}

Let $X$ and $Y$ be two arenas.
For any move $m$ of the arena $X$ we write $m^{X\rightarrow Y}$ to denote the same move seen as move of the component $X$ of the arena $X\rightarrow Y$.
Similarly we use the notation $m^{Y\rightarrow X}$.
We write $\ord_X{m}$ to denote $\ord{m}$, the order of the move $m$ in the arena $X$, $\ord_{X\rightarrow Y}{m}$ to denote the order of $m^{X\rightarrow Y}$ (in the arena $X\rightarrow Y$) and $\ord_{Y\rightarrow X}{m}$ to denote the order of $m^{Y\rightarrow X}$.

\begin{lemma}
\label{lem:compositionorder}
Let $A$, $B$ and $C$ be three arenas. We have:
$$\begin{array}{lll}
\forall m \in A:
    &  \ord_{A\rightarrow B}{m} = \ord_{A\rightarrow C}{m} \ ,\\
\forall m \in B:
    & \ord_{A\rightarrow B}{m} \geq \ord_{B\rightarrow C}{m}  & \mbox{for $m$ initial,}\\
    & \ord_{A\rightarrow B}{m} = \ord_{B\rightarrow C}{m} & \mbox{for $m$ non initial,} \\
\forall m \in C:
    & \ord_{A\rightarrow C}{m} \geq \ord_{B\rightarrow C}{m} \iff
\ord{A} \geq \ord{B}\ & \mbox{for $m$ initial,}\\
    & \ord_{A\rightarrow C}{m} = \ord_{B\rightarrow C}{m}   & \mbox{for $m$ non initial.}
\end{array}
$$
\end{lemma}





\subsubsection{Interaction sequences}
Let us first recall the definition of an interaction sequence.
Let $A$,$B$ and $C$ be three games. 
We say that $u$  is an \defname{interaction sequence} of $A$,$B$ and $C$ if $u\filter A,B$ is a valid position of the game $A\rightarrow B$
(i.e.~$u\filter A,B \in P_{A\rightarrow B}$) 
and  $u\filter B,C$ is a valid position of the game
$B\rightarrow  C$. We write $Int(A,B,C)$ to denote
the set of all such interaction sequences.

Let $\sigma:A\rightarrow B$ and $\mu:B\rightarrow C$
be two strategies. We write $\sigma \parallel \mu$ to denote the 
set of interaction sequences that unfold according to the strategy $\sigma$ in the $A,B$-projection of the game and 
to $\mu$ in the $B,C$-projection:
$$ \sigma \parallel \mu = \{ u\filter A,B \in \sigma \vee u \filter B,C \in \mu \} \ .$$
The composite of $\sigma$ and $\mu$ is then defined as $\sigma ; \mu = \{ u \filter A,C \ | \ u \in \sigma \parallel \tau \}$.

The diagram below shows the structure of an interaction sequence
from $\sigma \parallel \mu$. There are four states represented by the rectangular boxes. The content of the state shows who is to play in each of the game $A\rightarrow B$, $B\rightarrow C$ and $A\rightarrow C$.
For instance in state $OPP$, it is O's turn to play in 
$A\rightarrow B$ and P's turn to play in $B\rightarrow C$ and $A\rightarrow C$. Arrows represent the moves.
When specifying interaction sequence,
the following bullet symbols are used to represent moves:
$\pmove$ for P-moves, $\omove$ for O-moves, $\pomove$ 
for a move playing the role of P in $A\rightarrow B$
and O in $B\rightarrow C$ and $\opmove$ for
the symmetric of $\pomove$.
We sometimes add a subscript to the symbols $\pmove$ and $\omove$ to denote the component in which the moves is played ($A$ or $C$).


\tikzstyle{state}=[rectangle,draw=blue!50,fill=blue!20,thick,minimum height = 4ex, text width=4cm]
\tikzstyle{move}=[->,shorten <=1pt,>=latex',line width=1pt]
\tikzstyle{intmove}=[dashed] 
\tikzstyle{extomove}=[color=\extomovecolor] 
\tikzstyle{genomove}=[]%[dashed]
\tikzstyle{genpmove}=[color=\genpmovecolor]
\def\sep{1.5cm} 
\begin{table}[htbp]
\begin{center}
\begin{tikzpicture}[node distance=1.7cm]

% the four states 
\path 
 node(oooT)  [state] {}
 node(opp)   [state, below of=oooT] {}
 node(pop)   [state, below of=opp]  {}
 node(oooB)  [state, below of=pop] {}
 node(title) [anchor=south, at=(oooT.north), minimum height = 4ex, text width=4cm] { };

\path
% text in the title centered in 3 columns
  ([xshift=-\sep]title) node {$A\Rightarrow B$}
        (title) node {$B\Rightarrow C$}
        ([xshift=\sep]title) node {$A\Rightarrow C$}

% text in the states centered in 3 columns
  ([xshift=-\sep]oooT) node {O}
        (oooT) node {O}
        ([xshift=\sep]oooT) node {O}
  ([xshift=-\sep]opp) node {O}
        (opp) node {P}
        ([xshift=\sep]opp) node {P}
  ([xshift=-\sep]pop) node {P}
        (pop) node {O}
        ([xshift=\sep]pop) node {P}
  ([xshift=-\sep]oooB) node {O}
        (oooB) node {O}
        ([xshift=\sep]oooB) node {O}

% text in between two arrows giving the arena of the move
  (oooT) to node {\bf C} (opp)
  (opp) to node {\bf B} (pop)
  (pop) to node {\bf A} (oooB)

% arrows representing the moves
  (opp.20)    edge[move, genpmove]
		node[right] {$\mu$}
		node[left]{$\pmove$} (oooT.-20)
  (oooT.-160) edge[move, extomove, genomove]
		node[left] {$env_\mu$}
		node[right]{$\omove$} (opp.160)
  (pop.20)    edge[move, genomove,genpmove,intmove]
		node[right] {$\sigma$}
		node[left]{$\pomove$} (opp.-20)
  (opp.-160)  edge[move, genomove, genpmove,intmove]
		node[left] {$\mu$} 
		node[right]{$\opmove$}  (pop.160)
  (oooB.20)   edge[move, extomove,genomove]
		node[right] {$env_\sigma$}
		node[left]{$\omove$} (pop.-20)
  (pop.-160)  edge[move, genpmove]
		node[left] {$\sigma$}
		node[right]{$\pmove$} (oooB.160);

%\draw[move, genpmove] (3.5cm,-1cm) -- +(1,0) node[right] {Generalised P-move \& External P-move };
%\draw[move, genomove,genpmove] (3.5cm,-2cm) -- +(1,0) node[right] {Generalised O-move \& Generalised P-move};
%\draw[move, genomove,extomove] (3.5cm,-3cm) -- +(1,0) node[right] {Generalised O-move \& External O-move};
\draw[move] (3.5cm,-1cm) -- +(1,0) node[right] {External move};
\draw[move,intmove] (3.5cm,-2cm) -- +(1,0) node[right] {Internal move};
\draw[line width=1pt,extomove] (3.5cm,-3cm) -- +(1,0) node[right] {External O-move};
\draw[line width=1pt,genpmove] (3.5cm,-4cm) -- +(1,0) node[right] {Generalised P-move};
\end{tikzpicture}
\end{center}
\caption{Structure of an interaction sequence.}
\label{tab:interseq}
\end{table}

Note that in state OPP, the alternation condition (for each of the three games involved) prevents the players from playing in A. Indeed, the O-moves in component $A$ of $A\rightarrow B$ are also $O$-moves in component $A$ of $A\rightarrow C$ however the state name indicates that the next move in $A\rightarrow B$ must be an O-move and the next move in $A\rightarrow C$ must be a P-move.

Similarly, in the top state OOO, the players cannot make move in B since the O-moves in component B of the game $B\rightarrow C$ correspond to P-moves in the component B of $A\rightarrow B$. However the state name indicates that the next move in $A\rightarrow B$ and the next move in $B\rightarrow C$ must be played by O.


Let $u \in Int(A,B,C)$ and $m$ be a move of $u$.
The \defname{component} of $m$ is $A,B$ if 
after playing $m$ the game is under the control 
of the strategy $\sigma$ and $B,C$ otherwise (if $\mu$ has control).
In other words, the moves $\omove, \pmove \in A$
and $\opmove \in B$ shown on the diagram of Table \ref{tab:interseq}
have component $A,B$ and 
$\omove, \pmove \in C$ and $\pomove \in B$
have component $B,C$.


Also we call \defname{generalized O-move in component $A,B$}
moves that play the role of O in the game $A\rightarrow B$, that is to say moves represented by $\opmove$ and $\omove_A$.
Similarly $\pomove$ and $\pmove_A$ moves are the \defname{generalized P-moves in component $A,B$},
$\omove_C$ and $\pomove$ moves are
the \defname{generalized O-moves in component $B,C$}
and  $\pmove_C$ and $\opmove$ moves are the \defname{generalized P-moves in component $B,C$}.

The P-view (also called {\emph core} in \cite{McCusker-GamesandFullAbstrac}) of an interaction sequence $u \in Int(A,B,C)$, written $\overline{u}$ or $\pview{u}$ is defined as:
\begin{align*}
\pview{u\cdot \extomove{n}} &= \extomove{n} &
\mbox{ if \extomove{$m$} is an \extomove{external O-move} initial in C,}\\
\pview{\Pstr{u\cdot (m)m\cdot v \cdot (n-m,45){\extomove{n}} }} &= \extomove{n} &\mbox{ if \extomove{$m$} is an \extomove{external O-move} non initial in C,}\\
\pview{u \cdot \genpmove{m}} &= \pview{u}\cdot \genpmove{m}  & \mbox{ if \genpmove{$m$} is a \genpmove{generalised P-move}.}\\ 
\end{align*}

We can show the following property by an easy induction :
\begin{lemma}
\label{lem:pviewAC_eq_ACpview}
 Let $u$ be an interaction sequence in $Int(A,B,C)$ then
$$\pview{u} \upharpoonright A,C = \pview{u \upharpoonright A,C} \ .$$
\end{lemma}

\subsection{Unfinished proof of compositionnality} 
{\bf Notation} In plays, the symbol $\omove$ represents
an O-move and $\pmove$ represents
a P-move. For interaction sequences we also use
the symbols $\opmove$ and $\pomove$ as defined in Table \ref{tab:interseq}.

We write $s \subseqof t$ to say that $s$ is a subsequence (with pointers) of $t$, $s \prefixof t$ to say that $s$ is a prefix (with pointers)
of $t$ and  $s \suffixof t$ to say that $s$ is a suffix of $t$.



\begin{lemma}
\label{lem:interjump}
Let $X$ be a component (either  $A,B$ or  $B,C$).
Let $u$ be an interaction sequence of the form
$ u =  
\Pstr[0.5cm][2pt]{ \ldots (b){\stk \beta \pmove}  \ldots
 {n}  \ldots  (a-b,30){\stk \alpha\omove}
\ldots m}$ where:
\begin{itemize}[-]
\item $\alpha,\beta$ are external moves in component $X$ (necessarily both played in $A$ or in $C$),
\item  $m$ is either played in $B$ or an external P-move in $X$,
\item  $\alpha$ is visible at $m$ in $X$ \emph{i.e.}~$\alpha\in \pview{u \upharpoonright X}$ (consequently $\beta$ is also visible).
\end{itemize}
Then $n \not\in \pview{u \upharpoonright A, C}$.
\end{lemma}
\begin{proof}
Since $\alpha$ is an O-move, $\alpha$ and $\beta$ are necessarily played in the same arena ($A$ or $C$).
Take $v=u$ if $m$ is a generalized O-move in $X$
and $v=u_{<z}$ otherwise (if $m$ is a generalized P-move in $X$).
The third assumption implies 
$\alpha,\beta\in \pview{v}$.
The last move in $v$ is necessarily a generalized O-move in component $X$ (see diagram of Table \ref{tab:interseq}) 
therefore by \cite[Lemma 3.3.1]{Harmer2005}
we have $\pview{v \filter X} = \pview{\overline{v} \filter X} \subseqof \overline{v} \subseqof \overline{u}$.
Thus $\alpha,\beta \in \overline{u}$ and
since $\alpha,\beta$ are played in $A,C$ we have 
$\alpha,\beta  \in \overline{u} \upharpoonright A,C 
= \pview{u \upharpoonright A,C}$ (Lemma \ref{lem:pviewAC_eq_ACpview}).
Finally since $n$ lies underneath the $\beta$-$\alpha$ PO-arc 
it cannot appear in the P-view  $\pview{u \upharpoonright A,C}$.
\end{proof}

\begin{lemma}
\label{lem:in_pviewAC_imp_in_pviewX}
Let $u$ be an interaction sequence in $Int(A,B,C)$ and
$n$ be a move of $u$ such that $n\in\pview{u \filter A,C}$:
\begin{enumerate}[i.]
\item 
if all the moves in $u_{\suffixof n}$ 
are played in $C$  then $n \in \pview{u \filter B,C}$;
\item 
if all the moves in $u_{\suffixof n}$ are played in $A$ then $n \in \pview{u \filter A,B}$.
\end{enumerate}
\end{lemma}
\begin{proof}
\begin{enumerate}[(i)]
\item
We show the contrapositive. Suppose that $n \not\in\pview{u \filter B,C}$. This must be due to one of the following  two
reasons:
\begin{itemize}[-]
\item $\pview{u \filter B,C}$ contains an initial move $c_0 \in C$
occurring after $n$ in $u$.


By \cite[Lemma 3.3.1]{Harmer2005}
we have $\pview{u \filter B,C} = \pview{\overline{u} \filter B,C} \subseqof \pview{u}$, thus $c_0$ also occurs in $\pview{u}$.
Since $c_0$ belongs to $C$ we have
$c_0 \in \pview{u} \filter A,C=
\pview{u \filter A,C}$ (Lemma \ref{lem:pviewAC_eq_ACpview}).
Thus the P-view $\pview{u \filter A,C}$
starts with the initial move $c_0$ and
since $n$ occurs before $c_0$, $n$ does not occur in the P-view.

\item $n$ lies underneath a PO-arc $\beta$-$\alpha$ visible 
at $ u \filter B,C$.
By assumption, since $\alpha$ occurs after $n$ in $u$, it must belong to $C$. We can therefore apply Lemma \ref{lem:interjump}
with $X\leftarrow B,C$ which gives
$n \not\in\pview{u \filter A,C}$.
\end{itemize}

\item Suppose that $n \not\in\pview{u \filter A,B}$ then either:
\begin{itemize}[-]
\item $\pview{u \filter A,B}$ contains an initial move $b_0 \in B$
occurring after $n$ in $u$. But this is impossible since by assumption all the moves occurring after $n$ in $u$ belong to $A$.

\item or $n$ lies underneath a PO-arc $\beta$-$\alpha$ in $A,B$.
By assumption, since $\alpha$ occurs after $n$ it must belong to $A$. We can then conclude using 
Lemma \ref{lem:interjump} with $X\leftarrow A,B$.
\end{itemize}
\end{enumerate}
\end{proof}

Note that we cannot completely relax the assumption 
which says that moves in $u_{\suffixof n}$ are all in the same component.
For instance take $u = \Pstr[0.5cm]{(co){\omove_C}\thinspace 
(b0-co){\opmove} \thinspace 
(n){\stk{\pmove_A}{n}} \thinspace 
(b1-co){\opmove}}$ then we have $n\in\pview{u\filter A,C}$ but $n\notin\pview{u\filter A,B}$.




\begin{lemma}
\label{lem:oviewsegmentinB}
For any legal sequence $s = \ldots x \cdot r \cdot y$ of a game $A\rightarrow B$ if $x, y \in A$ and $x$ is O-visible from $y$ then any move in $r$ occurring in $\oview{s}$ belongs to $A$.
\end{lemma}
\begin{proof}
We proceed by induction on the length of the segment $r$.
Base case $r=\epsilon$ is trivial. Suppose $r = r' \cdot m$.
If $y$ is an O-move then by the Switching Condition
$m$ is necessarily in $A$. Clearly $x$ is O-visible from $m$ thus  by the I.H. any move from $r$ occurring in the O-view is in $A$.

If $y$ is a P-move then it cannot point to an initial move in $B$. Indeed, suppose that it points to an initial O-move $b_0 \in B$ then
we have $\oview{s} = b_0 \cdot y$ which contradicts the fact that $x\in \oview{s}$.
Thus $y$ points to a move in $A$ and again we can conclude using the induction hypothesis.
\end{proof}


\begin{lemma}[P-visibility decomposition (from $C$)]
\label{lem:middlepomove}
Let $u = \ldots n' \cdot r \cdot m \in Int(A,B,C)$ where
$n'$ is a $\omove_A$-move verifying $n' \in \pview{u\filter A,C}$ and $m$ is in $\{ \pmove_C, \opmove, \pomove \}$. Then there is a $\pomove$-move $\gamma$ in $r \cdot m$ such that $\gamma \in \pview{u\filter B,C}$ , $n' \in \pview{u_{\leq \delta} \filter A,B}$ and $\delta$ is justified by a move occurring before $n'$.
\end{lemma}
\begin{proof}
By induction on $|r|$.
If $r=\epsilon$ then necessarily $u = \ldots \stk{\omove_A}{n'} \thinspace\stk \pomove m$ where $m$ points before $n'$ ($n'$ being played in $A$ cannot justify $m$ played in $B$) so we just need to take $\gamma = m$.
If $|r|=1$ then either 
$u = \ldots \stk{\omove_A}{n'} \pomove\thinspace\stk {\pmove_C} m$
or $u = \ldots \stk{\omove_A}{n'} \pomove\thinspace\stk \opmove m$.
In both cases we can take $\gamma$ to be $\pomove$, the move between $n'$ and $m$.
Suppose $|r|>1$. Let $m^-$ denote the move preceding $m$ in $u$.
We proceed by case analysis:
\begin{enumerate}[i.]
\item Suppose $m = \pmove_C$ and $m^- = \omove_C$.
Let $q$ be the external P-move that justifies $m^-$.
Since $n' \in \pview{u\filter A,C}$, $q$ must occur after $n'$ in $u$:
$$ 
\begin{array}{ccccl}
A & \stackrel\sigma{\longrightarrow} & B & \stackrel\mu{\longrightarrow} & C \\
&\vdots&&\vdots\\
n' \omove\\
&\vdots&&\vdots  \\
&& & &  \rnode{q}{\pmove}q  \\
&\vdots&&\vdots  \\
&& & &  \rnode{mp}{\omove}m^-  \\
&& & &  \rnode{m}{\pmove}m  \\
\end{array}
\ncarc[arcangleA=60,arcangleB=60]{->}{mp}{q}
 $$  
Thus we can use the induction hypothesis (with $u\leftarrow u_{\prefixof q}$): there is a $\pomove$-move $\gamma$ 
in $u_{]n',q]}$ pointing before $n'$ such that $\gamma \in \pview{u_{\prefixof q} \filter B,C}$, $n' \in \pview{u_{\prefixof \gamma} \filter A,B}$.
Moreover $\pview{u_{\prefixof q} \filter B,C} \prefixof \pview{u_{\prefixof m} \filter B,C}$ (since $q$ is visible from $m$ in $B,C$) thus we have $\gamma \in \pview{u_{\prefixof m} \filter B,C}$ as required.

\item Suppose $m = \pmove_C$ and $m^- = \pomove \in B$.
Again we can conclude using 
the induction hypothesis with $u \leftarrow u_{\prefixof m^-}$.

\item Suppose $m = \pomove \in B$.

Suppose that all the moves in $r$ are in $A$.
Then $r$ is of the form $(\pmove_A \omove_A)^*$ (where $(\cdot)^*$ denotes the Kleenee star operator). 
We just need to take $\gamma = m$. 
Indeed, moves in $u_{\suffixof m}$ are all in $A$
and by assumption $n'\in\pview{u\filter A,C}$  therefore
Lemma \ref{lem:in_pviewAC_imp_in_pviewX}(ii) gives
$n'\in\pview{u\filter A,B}$.
Also, since $m$ is a $\pomove$-move, 
its justifier is a $\opmove$-move but $r$ contains only $\omove$ and $\pmove$ moves hence $m$'s justifier must occur before $n'$.

Suppose that $r$ contains at least one move in $B$. Let $b$ be the last such move, then $u$ is of the form $\ldots n' \cdot \ldots \cdot \stk\opmove  b \cdot (\pmove_A \omove_A)^* \cdot\thinspace\stk\pomove m $. We then have
$u\filter B,C = \ldots n' \cdot \ldots \cdot 
\thinspace\stk\opmove b \thinspace\cdot \stk\pomove m $ thus $b \in \pview{u\filter B,C}$. We can then conclude by applying the induction hypothesis with $u \leftarrow u_{\prefixof b}$.

\item Suppose $m = \pomove \in B$.
If $m^- = \opmove \in B$ then the I.H. with $u \leftarrow u_{\prefixof m^-}$ permits us to conclude.
If $m^- = \omove \in C$ then we conlude by applying  the I.H. on $u \leftarrow u_{\prefixof q}$ where $q$ is the external P-move in $C$ justifying
$m^-$.
\end{enumerate}
\end{proof}

We now show the lemma symmetric to the previous one:
\begin{lemma}[P-visibility decomposition (from $A$)]
\label{lem:middleopmove}
Let $u = \ldots n' \cdot r \cdot m \in Int(A,B,C)$ where
$n'$ is an O-move \emph{non initial} in $C$ verifying $n' \in \pview{u\filter A,C}$ and $m$ is in $\{\pmove_A, \opmove, \pomove\}$. Then there is a $\pomove$-move $\gamma$ in $r \cdot m$ such that $\gamma \in \pview{u\filter A,B}$ , $n' \in \pview{u_{\leq \delta} \filter B,C}$ and $\delta$ is justified by a move occurring before $n'$.
\end{lemma}
\begin{proof}
The proof is almost symmetrical to the previous one (Lemma \ref{lem:middlepomove}). We proceed by induction on $|r|$.
If $r=\epsilon$ then necessarily $u = \ldots \stk {\omove_C} {n'} \thinspace\stk \opmove m$ where $m$ points before $n'$ (it cannot point to $n'$
since $n'$ is not initial in $C$). Thus we just need to take $\gamma = m$.

If $|r|=1$ then either 
$u = \ldots \stk {\omove_C} {n'} \thinspace\opmove\thinspace\thinspace\stk{\pmove_A} m$
or $u = \ldots \stk {\omove_C} {n'} \thinspace\opmove\thinspace\thinspace\stk \pomove m$.
In both cases we can take $\gamma$ to be $\pomove$, the move between $n'$ and $m$.
Suppose $|r|>1$. Let $m^-$ denote the move preceding $m$ in $u$.
We do a case analysis:
\begin{enumerate}[i.]
\item Suppose $m = \pmove_A$ and $m^- = \omove_A$.
Let $q$ be the external P-move that justifies $m^-$.
Since $n' \in \pview{u\filter A,C}$, $q$ must occur after $n'$ in $u$:
$$ 
\begin{array}{rcccl}
A & \stackrel\sigma{\longrightarrow} & B & \stackrel\mu{\longrightarrow} & C \\
&\vdots&&\vdots\\
&&&& \omove n'\\
&\vdots&&\vdots  \\
q\rnode{q}{\pmove}  \\
&\vdots&&\vdots  \\
m^-\rnode{mp}{\omove}  \\
m \rnode{m}{\pmove}  \\
\end{array}
\ncarc[arcangleA=60,arcangleB=60]{->}{mp}{q}
 $$  
Thus we can use the induction hypothesis (with $u\leftarrow u_{\prefixof q}$): there is a $\opmove$-move $\gamma$ 
in $u_{]n',q]}$ pointing before $n'$ such that $\gamma \in \pview{u_{\prefixof q} \filter A,B}$, $n' \in \pview{u_{\prefixof \gamma} \filter B,C}$.
Moreover $\pview{u_{\prefixof q} \filter A,B} \prefixof \pview{u_{\prefixof m} \filter A,B}$ (since $q$ is visible from $m$ in $A,B$) thus we have $\gamma \in \pview{u_{\prefixof m} \filter A,B}$ as required.

\item Suppose $m = \pmove_A$ and $m^- = \pomove$ then again we can conclude using the I.H. with $u \leftarrow u_{\prefixof m^-}$.

\item Suppose $m = \opmove$.
\begin{itemize}[-]
\item Suppose that $r$ does not contain any move in $B$  then $r$ is of the form $(\pmove_C \omove_C)^*$. 

We just need to take $\gamma = m$. 
Indeed:
\begin{enumerate}
\item By lemmma \ref{lem:in_pviewAC_imp_in_pviewX}(i)
we have $n'\in \pview{u\filter B,C}$.

\item  $m$ is justified by a move occurring before $n'$. 
Indeed, if $m$ is justified by a $\pomove$-move then since $n' \cdot r$ contains only $\omove$ and $\pmove$ moves, $m$'s justifier must occur before $n'$.
If $m$'s justifier is an initial $\omove_C$-move $c_i$, then 
by P-visibility we have $c_i \in \pview{u\filter B,C}$
but since the P-view computation ``stops'' when reaching an initial moves, in order to guarantee that $n'$ also belongs to the P-view (as shown in (a)) it must
occurs after $c_i$.
\end{enumerate}


\item Suppose that $r$ contains some move in $B$. Let $b$ be the last such move. Then $u$ is of the form $u = \ldots n' \cdot \ldots \cdot \stk\opmove  b \cdot (\pmove_A \omove_A)^* \cdot\ \stk\pomove m $. 
So we have
$u\filter B,C = \ldots n' \cdot \ldots \cdot \stk\opmove  b \cdot \stk\pomove m $ hence $b \in \pview{u\filter B,C}$. We can now 
conclude by applying the I.H. with $u \leftarrow u_{\prefixof b}$.
\end{itemize}

\item Suppose $m = \pomove \in B$.
If $m^- = \pomove \in B$ then the I.H. with $u \leftarrow u_{\prefixof m^-}$ permits us to conclude.
If $m^- = \omove \in A$ then we conclude by applying the I.H. on $u \leftarrow u_{\prefixof q}$ where $q$ is the external P-move in $A$ justifying $m^-$.
\end{enumerate}
\end{proof}

\begin{conjecture}
Let $\sigma : A \rightarrow B$ and $\mu : B \rightarrow C$
be two P-incrementally-justified well-bracketed
strategies. 
If $\ord{a} \geq \ord{B}$ then $\sigma ; \mu : A\rightarrow C$
is P-incrementally-justified.
\end{conjecture}

\begin{proof}[Beginning of a proof]
Let $u$ be a play of the interaction $u \in \sigma \| \mu$ between $\sigma$ and $\mu$
ending with an external P-move $m$
justified by $n$ in $\pview{u \upharpoonright A , C}$.
Let $n'$ be an external O-move occurring betweeen $n$ and $m$.
To show that $u \filter A,C$ is incrementally justified, we just need to prove that either $n'\not\in \pview{u \filter A,C}$ or $\ord_{A\rightarrow C} n' \leq \ord_{A\rightarrow C} m$. We have:
$$ u \filter A,C =  
\Pstr[0.5cm][2pt]{ \ldots (n){\stk {n} \omove}  \ldots
 {\stk {n'} \omove}  \ldots  (m-n,30){\stk m \pmove}
}
$$

Since $m$ is a P-move, it is not an initial move in $C$  and therefore Lemma \ref{lem:compositionorder} gives $\ord_{A\rightarrow C}{m} = \ord_{B \rightarrow C}{m}$.
Similarly, if $n'\in \pview{u \filter A,C}$ 
then necessarily $n'$ is not initial 
in $C$ because $n$ occurs before $n'$ in
$\pview{u \filter A,C}$, so we have $\ord_{B\rightarrow C}{n'} = \ord_{A\rightarrow C} {n'}$.

\begin{enumerate}[I.]
\item \label{case:mC}
Suppose $m \in C$, then $n$ must also be in $C$.

\begin{enumerate}[{\ref{case:mC}}.1]
\item \label{case:mCnpC} Suppose $n'\in C$. The projection of $u$ on the game $B\rightarrow C$ has the following form:
$$ u \filter B,C =  
\Pstr[0.5cm][2pt]{ \ldots (n){\stk {n} \omove}  \ldots
 {\stk {n'} \omove}  \ldots  (m-n,30){\stk m \pmove}
}$$

Since $\mu$ is P-ij, $n'$ must not occur in the P-view $\pview{u_{\prefixof m} \filter B,C}$, thus $n'$ lies underneath a PO arc occurring in $\pview{u \filter B,C}$. Let us denote this arc by $\beta$-$\alpha$ where $\beta$ and $\alpha$ denote the arc's nodes. We have:
$$ u \filter B,C = \ldots  
\Pstr[0.5cm]{
 (n){\stk{n} \omove } \ldots (b){\stk\beta \pmove} \ldots \stk{n'} \omove  
\ldots (a-b){\stk\alpha \omove}  \ldots (m-n){\stk m  \pmove }
} $$
with $\ord_{B\rightarrow C} \alpha \leq \ord_{B\rightarrow C} m$ (by P-ij of $\mu$).
  
\begin{enumerate}[{\ref{case:mCnpC}}.i]
\item Suppose $\alpha \in C$ then $\beta\in C$ (since $\alpha$ is an O-move).

By instancing Lemma \ref{lem:interjump} with
$X\leftarrow B,C$ and $n \leftarrow n'$ we obtain that $n' \not\in\pview{u \filter A,C}$.

\item Suppose $\alpha \in B$ then $\beta \in B$.

We have $\alpha \in \pview{u \filter B,C}
= \pview{\pview{u} \filter B,C} \subseqof
\pview{u}$ (\cite[Lemma 3.3.1]{Harmer2005}).

Suppose that $n' \in \pview{u\filter A,C}$, then 
\begin{align*}
n' & \in \pview{u\filter A,C} \\
& = \pview{u}\filter A,C 
& \mbox{(Lemma \ref{lem:pviewAC_eq_ACpview})} \\
& \suffixof \pview{u_{\prefixof \alpha}}\filter A,C
& \mbox{($\alpha \in \pview{u}$, $n'$ occurs before $\alpha$ in $u$)} \\
& = \pview{u_{\prefixof \alpha} \filter A,C} 
& \mbox{(Lemma \ref{lem:pviewAC_eq_ACpview})}
\end{align*}
But since $n'$ occurs before $\alpha$ in $u$ this implies
that $n' \in \pview{u_{\prefixof \alpha}\filter A,C}$
so we can apply Lemma \ref{lem:middleopmove}
on $u_{\prefixof \alpha}$:
there exists some $\opmove$-move $\gamma$ 
occurring between $n'$ and $m$ and pointing before $n'$
such that $\gamma \in \pview{u\filter A,B}$ and $n' \in \pview{u_{\leq \gamma} \filter B,C}$.

Hence:
\begin{align*}
\ord_{A\rightarrow C} n' 
& = \ord_{B\rightarrow C} n' & \mbox{(n' non initial)} \\
& \leq \ord_{B\rightarrow C} \gamma & \mbox{($\mu$ is P-ij)} \\
& = \ord_{A\rightarrow B} \gamma & \mbox{($\gamma$ non initial in $B$)} \\
& \leq \ord_{A\rightarrow B} \alpha & \mbox{($\sigma$ is P-ij)} \\
& = \ord_{B\rightarrow C} \alpha & \mbox{($\alpha$ non initial in $B$)} \\
& \leq \ord_{B\rightarrow C} m & \mbox{($\mu$ is P-ij)} \\
& = \ord_{A\rightarrow C} m & \mbox{($m$ is not initial in $C$)} \\
\end{align*}
\end{enumerate}


\item Suppose $n'\in A$. 

Suppose that $n' \in \pview{u\filter A,C}$, then by Lemma \ref{lem:middlepomove}
there must be some $\pomove$-move $\gamma$ 
occurring between $n'$ and $m$ and pointing before $n'$
such that $\gamma \in \pview{u\filter B,C}$ and $n' \in \pview{u_{\leq \delta} \filter A,B}$:
$$ 
\begin{array}{ccccc}
A & \stackrel\sigma{\longrightarrow} & B & \stackrel\mu{\longrightarrow} & C \\
&\vdots&&\vdots\\
&&&& \rnode{n}{n}\omove \\
&\vdots&\rnode{gj}{\cdot}&\vdots\\
n' \omove \\
&\vdots&&\vdots  \\
&&\rnode{g}{\gamma} \pomove \\
&\vdots&&\vdots  \\
&&&&\rnode{m}{m} \pmove \\
\end{array}
\ncarc[arcangleA=30,arcangleB=30]{->}{m}{n}
\ncarc[arcangleA=30,arcangleB=30]{->}{g}{gj}
 $$  

Since $n'$ is visible from $\gamma$ in $A,B$
but $\gamma$ is justified by a move occurring before $n'$,
by P-incrementally-justification of $\sigma$
we must have:
$$ \ord_{A\rightarrow B} n'  \leq \ord_{A\rightarrow B} \gamma \ .$$
Similarly, since $\gamma$ is visible from $m$ in $B,C$ and
$m$ is justified by $n$ occurring before $\gamma$, by P-incrementally-justification of $\mu$ we have:
$$ \ord_{B\rightarrow C} \gamma  \leq \ord_{B\rightarrow C} m \ .$$

Hence since $\ord_{B\rightarrow C} m = \ord_{A\rightarrow C} m$ and $\ord_{A\rightarrow B} m = \ord_{A\rightarrow C} m$ we conclude:
$$ \ord_{A\rightarrow C} n' \leq \ord_{A\rightarrow C} m \ .$$
\end{enumerate}

\item \label{case:mA} Suppose $m\in A$.
\begin{enumerate}[{\ref{case:mA}}.1]
\item \label{case:mAnC} Suppose  $n$ initial in $C$.
	\begin{enumerate}[{\ref{case:mAnC}}.i]
	\item Suppose $n'\in C$ \ldots
	\item Suppose  $n'\in A$, then necessarily $\ord_{A\rightarrow C}{n'} <
\ord_{A\rightarrow C}{n}$ \ldots
	\end{enumerate}
\item \label{case:mAnA} Suppose $n\in A$.
	\begin{enumerate}[{\ref{case:mAnA}}.i]
	\item \label{case:mAnAnpC} Suppose $n'\in C$ \ldots 
	\item \label{case:mAnAnpA} Suppose $n'\in A$
 
Since $\sigma$ is P-ij, $n'$ cannot occur in the P-view $\pview{u_{\prefixof m} \filter A,B}$ thus $n'$ must occurs underneath a PO arc occurring in $\pview{u_{\prefixof m} \filter A,B}$. Let us denote this arc $\beta$-$\alpha$:
$$ u_{\prefixof m} \filter A,B = \ldots  
\Pstr[0.5cm]{
 (n){\stk{n} \omove } \ldots (b){\stk\beta \pmove} \ldots \stk{n'} \omove  
\ldots (a-b){\stk\alpha \omove}  \ldots (m-n){\stk m  \pmove }
} \ .
$$

\begin{enumerate}[{\ref{case:mAnA}ii}.a]
\item \label{case:mAnAnpAalphaB} Suppose $\alpha \in A$ then $\beta\in A$.

By instancing Lemma \ref{lem:interjump} with
$X\leftarrow A,B$ and $y,b,x,z \leftarrow \beta, n', \alpha, m$ we obtain that $n' \not\in\pview{u_{\prefixof m} \filter A,C}$.


\item Suppose $\alpha \in B$. $\alpha$ cannot be initial in $B$ since it is an O-move therefore $\beta$ must also belong to $B$.

We have
\begin{align}
\ord_{A\rightarrow B} \alpha
 & \leq  \ord_{A\rightarrow B} m 
& \mbox{($\sigma$ is P-ij and $\alpha$ is visible from $m$ in $A\rightarrow B$)}  \nonumber \\
&= \ord_{A\rightarrow C} m 
& \mbox{(Lemma \ref{lem:compositionorder}, $m \in A$)}  \nonumber \\
&<  \ord_{A\rightarrow C} n'  & \mbox{(by assumption)} \nonumber \\
&=  \ord_{A\rightarrow B} n'  & \mbox{(Lemma \ref{lem:compositionorder}, $n' \in A$)}  \nonumber 
\end{align}
This case corresponds to the situation 
analysed in the next sub case.

\item Consider the following situation:
\label{case:situation}
$$ 
\begin{array}{cccccccl}
A & \stackrel\sigma{\longrightarrow} & B & & B & \stackrel\mu{\longrightarrow} & C \\
&\vdots&&& & \vdots\\
&&\omove & \rnode{b}{\beta} & \pmove \\
&\vdots& & &&\vdots && \mbox{with $\ord_{A\rightarrow B} \alpha < \ord_{A\rightarrow B} n'$.} \\
n' \omove && & &  \\
&\vdots& & &&\vdots  \\
&&\pmove & \rnode{a}{\alpha} & \omove \\
\end{array}
\ncarc[arcangleA=30,arcangleB=30]{->}{a}{b}
 $$  

Since $\ord_{A\rightarrow B} \alpha < \ord_{A\rightarrow B} n'$
and $\alpha$ points to $\beta$, by P-ij of $\sigma$, $n'$ must not be visible from $\alpha$ in $A\rightarrow B$. Hence there must be a PO-arc $\beta^2$-$\alpha^2$ jumping over $n'$ and visible from $\alpha$ in $A\rightarrow B$
verifying $\ord_{A \rightarrow B} \alpha^2 
\leq \ord_{A \rightarrow B} \alpha$ (by P-ij of $\sigma$, since $\alpha^2$ is visible from $\alpha$ and $\alpha$ points to $\beta$). 


\begin{itemize} %[{\ref{case:situation}}.A]
 \item \label{case:situation:base} Suppose that $\alpha^2 \in A$. 
Then $\beta^2 \in A$ (since $\alpha^2$ is an O-move).
$$ 
\begin{array}{ccccccc}
A & \stackrel\sigma{\longrightarrow} & B & & B & \stackrel\mu{\longrightarrow} & C \\
&\vdots&&& & \vdots\\
&&\omove & \rnode{b}{\beta} & \pmove \\
&\vdots &&&& \vdots  \\
\rnode{b2}{\beta^2 \pmove}&  \\
& \vdots &&&&\vdots  \\
n' \omove && & &  \\
& \vdots &&&&\vdots  \\
\rnode{a2}{\alpha^2 \omove}& \\
& \vdots &&&&\vdots  \\
&&\pmove & \rnode{a}{\alpha} & \omove \\
\end{array}
\ncarc[arcangleA=30,arcangleB=30]{->}{a}{b}
\ncarc[arcangleA=90,arcangleB=90]{->}{a2}{b2}
 $$  
By instancing Lemma \ref{lem:interjump} with
$X\leftarrow A,B$ and $y,b,x,z \leftarrow \beta^2, n', \alpha^2, \alpha$ we obtain that $n' \not\in\pview{u_{\prefixof \alpha} \filter A,C}$ and since $\alpha$ is visible at $m$ in the game $A\rightarrow C$, $n'$ does not appear in $\pview{u_{\prefixof m} \filter A,C}$ 
either. 

\item Suppose that $\alpha^2 \in B$ then $\beta^2 \in B$:
$$ 
\begin{array}{ccccccc}
A & \stackrel\sigma{\longrightarrow} & B & & B & \stackrel\mu{\longrightarrow} & C \\
& \vdots &&&&\vdots  \\
&&\omove & \rnode{b}{\beta} & \pmove \\
& \vdots &&&&\vdots  \\
&& \pmove & \rnode{b2}{\beta^2} & \omove  \\
& \vdots &&&&\vdots  \\
n' \omove && & &  \\
& \vdots &&&&\vdots  \\
&&\omove & \rnode{a2}{\alpha^2} & \pmove \\
& \vdots &&&&\vdots  \\
&&\pmove & \rnode{a}{\alpha} & \omove \\
\end{array}
\ncarc[arcangleA=30,arcangleB=30]{->}{a}{b}
\ncarc[arcangleA=30,arcangleB=30]{->}{a2}{b2}
 $$  


The sequence $u_{\prefixof \alpha^2} \upharpoonright A, B$
has the following form:
$$\Pstr[0.1cm]{\cdots \stk\pmove{\beta^2} (o1)\omove \cdots (p1-o1)\pmove 
(o2)\omove \cdots (p2-o2)\pmove (o2)\omove \ \cdots\ 
\pmove  (ojump) \omove \cdots
(pjump-ojump) \pmove \omove
\cdots
\pmove (o4)\omove \cdots (p4-o4)\pmove \ \stk\omove{\alpha^2}
}$$
where the links and nodes shown are those relevant for the O-view computation.


Because of the Switching Condition, since $\beta^2, \alpha^2 \in B$ all the moves occurring between $\beta^2$ and $\alpha^2$ in the O-view are also in $B$.
Thus since $n'\in A$, there must be an OP-arc $\beta^3$-$\alpha^3$ in the O-view jumping over $n'$ in $u_{\prefixof \alpha^2} \upharpoonright A,B$:
$$ 
u_{\prefixof \alpha^2} \upharpoonright {A, B}
=
\Pstr[0.1cm]{\cdots \stk\pmove{\beta^2} (o1)\omove \cdots (p1-o1)\pmove 
(o2)\omove \cdots (p2-o2)\pmove (o2)\omove \ \cdots\ 
\pmove  (ojump) {\stk\omove{\beta^3}} \cdots
\stk\omove{n'} \cdots
(pjump-ojump) {\stk\pmove{\alpha^3}} \omove
\cdots
\pmove (o4)\omove \cdots (p4-o4)\pmove \ \stk\omove{\alpha^2}
}\ .
$$

%The move $\alpha^3$ is P-visible from

Moreover, O-moves (resp. P-moves) in the $B$ component of the game $A\rightarrow B$ become P-moves (resp. O-moves) in the game $B \rightarrow C$, therefore:
$$ 
u_{\prefixof \alpha^2} \upharpoonright {B, C}
=
\Pstr[0.1cm]{\cdots \stk\omove{\beta^2} (o1)\pmove \cdots (p1-o1)\omove 
(o2)\pmove \cdots (p2-o2)\omove (o2)\pmove \ \cdots\ 
\omove  (ojump) {\stk\pmove{\beta^3}} \cdots
\stk\pmove{n'} \cdots
(pjump-ojump) {\stk\omove{\alpha^3}} \pmove
\cdots
\omove (o4)\pmove \cdots (p4-o4)\omove \ \stk\pmove{\alpha^2}
} \ .
$$
Since $\alpha^3$ is visible from $\alpha^2$ in the game $B\rightarrow C$ but $\alpha^2$ points to $\beta^2$, by P-ij of $\mu$ we have
$ \ord_{B\rightarrow C} \alpha^3 \leq \ord_{B\rightarrow C} \alpha^2$. Moreover $\alpha^2$ and $\alpha^3$ are not initial therefore
they have the same order in the game $A\rightarrow B$ and
$B\rightarrow C$, thus we have:
$$
\ord_{A \rightarrow B} \alpha^3 
\leq \ord_{A \rightarrow B} \alpha^2
\leq \ord_{A \rightarrow B} \alpha < \ord_{A\rightarrow B} n' \ .
$$

By substituting
$\alpha$ and $\beta$ for $\alpha^3$ and $\beta^3$  
we fall back to the situation of case \ref{case:situation} and
the same case analysis can be carried on. 
Since the segment $u_{\prefixof \alpha}$ is of finite length,
the case analysis must come to an end and reach the sub case \ref{case:situation:base}  eventually. 
We can therefore conclude that
$n'$ does not appear in the P-view  $\pview{u_{\prefixof \alpha} \upharpoonright A,C}$.
\end{itemize}
\end{enumerate}

	\end{enumerate}
\end{enumerate}

\end{enumerate} 
\end{proof}

\section{Compositionnality - Syntactic approach}

\subsection{Definability result for Safe PCF}

We say that a PCF term is \defname{semi-safe} if it is of the form $N_0 N_1 \ldots N_k$ for $k\geq 1$ where each of the $N_i$ is safe or if it can be written $\lambda \overline{x} . N$ for some safe term $N$. Semi-safe terms are either safe or ``almost safe'' in the sense that they can be turned into an equivalent (i.e.~preserving the semantics) safe term  by performing $\eta$-expansions. Indeed, let $M$ be an semi-safe term that is unsafe.
If $M$ is of the first form $N_0 N_1 \ldots N_k : (A_1,\ldots,A_n)$ with $k\geq 1$ then let $\varphi_i:A_i$ for $i\in\{1..n\}$ be fresh variables , using the (app) and (abs) rules we can build the safe term $\lambda \varphi_1 \ldots \varphi_n . N_0 N_1 \ldots N_k \varphi_1 \ldots \varphi_n$. If $M$ is of the second form $\lambda \overline{x} . N$ then using the abstraction rule we can build the equivalent safe term $\lambda \overline{y} \overline{x}. N$  where $\overline{y} = fv(\lambda \overline{x}. N)$.

The $\beta$-normal form of a \pcf\ term is the possibly infinite term obtained by reducing all the redexes in $M$.

%We say that a \pcf\ term is in $\beta$-normal form it does not contain
%any $\beta$-redex but may contain other redexes (in particular it may contain
%an occurrence of the Y combinator, which would produce a $\beta$-redex if it was reduced). The $\beta$-normal form of a \pcf\ term can be obtained by
%computing the $\beta$-normal form of the term treated as a simply typed term  where Y, \pcfcond, \pcfsucc and \pcfpred\ are treated as ordinary constants.


The correspondence between safety and P-incremental-justification for the simply typed lambda calculus was shown
in \cite{blumong:safelambdacalculus}, Theorem 3(ii):

\begin{theorem}[Safety and P-incremental justification]
\label{thm:safeincrejust} In the simply typed lambda calculus:
\begin{enumerate}[(i)]
\item If $M$ is safe then $\sem{M}$ is P-incrementally justified.
\item If $M$ is a closed term and $\sem{M}$ is
  P-incrementally justified then the $\eta$-long form of the
  $\beta$-normal form of $M$ is safe.
\end{enumerate}
\end{theorem}

In the context of \pcf\, only the first part of the theorem holds (see \cite{blumtransfer} for the proof). However (ii) does not hold. Indeed, take the closed \pcf\ term $M = \lambda f x y. f (\lambda z. \pcfcond (\pcfsucc\ x) y z )$ where $x,y,z:o$ and $f:((o,o),o)$. $M$ is in normal form (the conditional  could  only be reduced if $x$ were first evaluated). The $\eta$-long form of the $\beta$-normal form of $M$ is therefore $M$ itself which is unsafe.
But clearly we have $\sem{M} = \sem{\lambda f x y. f (\lambda z. z)}$, and since  $\lambda f x y. f (\lambda z. z)$ is safe, by (i), $\sem{M}$ is P-incrementally justified.

Such counter-example arises because the conditional operator of \pcf\ permits us to build terms in normal form containing ``dead code'' {\it i.e.}~some subterm that will never be evaluated for any value of M's parameters. In the example given above, the dead code consists in the subterm $y$. In general, if the dead code part of the computation tree contains a variable that is not incrementally bound then the resulting term will be unsafe even if the rest of the tree is incrementally bound.
In the example above, it was possible to turn $M$ into the equivalent safe term $\lambda f x y. f (\lambda z. z)$ by eliminating the dead code from $M$.
We shall see how to generalise this to any \pcf\ term with a P-incrementally justified denotation.

Dead code elimination can be difficult to achieve in practice but the formal definition is not difficult to formulate. We say that a subterm $N$ occurring
in a context $C[-]$ in $M : (A_1, \ldots, A_n,o)$ is part of the \defname{dead code} of $M$ if for any term $T_0$ of the form $M M_1 \ldots M_n$,
any reduction sequence starting from $T_0$ does not involve a reduction of the subterm $N$ {\it i.e.}~for any reduction sequence $T_0 \rightarrow T_1 \rightarrow \ldots \rightarrow T_k$, there is no $j\in \{0.. k-1\}$ such that $T_j = C[N]$ and $T_{j+1} = C[N']$ for some term $N'$.


Let $M$  be a \pcf\ term in $\eta$-nf.
An occurrence of a variable $x$ in $M$ is said to be a \defname{dead occurrence}
if it occurs in the dead code of $M$. In other words, it is a
dead occurrence of $x$ if the corresponding node in the computation tree does not appear in any traversal of $\travset(M)$. Equivalently, thanks to the Correspondence Theorem, an occurrence of $x:B$ is dead if and only if the initial move
of the arena $\sem{B}$ does not appear in any play of $\sem{M}$.


We define $M^*$ as the term obtained from $M$ after substituting all subterms of the form  $x N_1 \dots N_k$ for some dead variable occurrence $x:(B_1,\ldots, B_k, o)$ by the constant $0$. This process is called \defname{dead variable elimination}.
Note that if $M$ is in $\eta\beta$-nf then so is $M^*$.

We also write $\tau(M)^*$ to denote the equivalent transformation on the computation tree. Since the computation tree is constructed from the $\eta$-nf of $M$, we will use this notation even when $M$ is not in $\eta$-nf.



\begin{proposition}[Incremental-binding and P-incremental-justification coincide] \
\label{prop:incrbound_imp_incrjustified_pcf} Let $M$ be a \pcf\ term in $\beta$-normal form.
\begin{enumerate}[(i)]
\item  If $\tau(M)$ is incrementally-bound then $\sem{M}$ is P-incrementally-justified,
\item  if $\sem{M}$ is P-incrementally-justified
then $\tau(M)^*$ is incrementally-bound.
\end{enumerate}
\end{proposition}
\begin{proof}
(i) The proof is exactly the same as in the simply typed lambda calculus case,
see \cite[Proposition 4.1.5(i)]{blumtransfer}.

\noindent (ii)
Take $M$ a \pcf\ term in $\beta$-normal form denoted by $\sem{M}$ P-incrementally-justified. Let $r$ denote the root of $\tau(M)^*$.
Let $n$ be a node of $\tau(M)^*$ labelled by the variable $x$.
$\tau(M)^*$ is free from dead code therefore $n$ is not a dead occurrence of $x$ and there exists a traversal of $\tau(M)^*$ of the form $t \cdot x$.

\pcf\ constants are of order $1$ at most therefore they cannot hereditarily justify a variable node, thus $x$ is necessarily hereditarily justified by the root $r$ of the computation tree.


By considering $t\cdot x$ as a traversal of $\tau(M)$,  the correspondence theorem gives $\varphi((t \cdot x) \upharpoonright r) = \varphi((t \upharpoonright r) \cdot x) \in \sem{M}$. Since $\sem{M}$ is P-incrementally-justified, $\varphi(x)$ must point to the last O-move in $\pview{?(\varphi(t \upharpoonright
r))}$ with order strictly greater than $\ord{\varphi(x)}$.
Consequently $x$ points to the last node in $\pview{?(t
\upharpoonright r)} \inter N^{\lambda}$ with order strictly greater than $\ord{x}$. We have:
\begin{align*}
\pview{?(t \upharpoonright r)} &= \pview{?(t) \upharpoonright r} = \pview{?(t)} \upharpoonright r & (\mbox{by \cite[lemma 3.1.23]{blumtransfer}}) \\
& = [r,x[ \ \upharpoonright r & (\mbox{by \cite[proposition 3.1.20]{blumtransfer}})
\end{align*}
Since $M$ is in $\beta$-nf, the set of nodes not hereditarily justified by $r$ is exactly the set of nodes hereditarily justified by $N_{\Sigma}$ thus
$[r,x[ \ \upharpoonright r = [r,x[\ \setminus\  N^{\upharpoonright \Sigma}$.
Moreover \pcf\ constants are of order $1$ at most therefore $N^{\upharpoonright \Sigma} = N_{\Sigma} \union N^c_{\Sigma}$
where $N^c_{\Sigma}$ is the set of children nodes of $N_{\Sigma}$.
Thus $(\pview{?(t \upharpoonright r)}\upharpoonright r) \inter N^{\lambda} =
([r,x[\ \setminus\  N_{\Sigma} \setminus N^c_{\Sigma} ) \inter N^{\lambda} =
([r,x[\ \setminus\  N^c_{\Sigma} )  \inter N^{\lambda}$, and
since $N^c_{\Sigma}$ is constituted of order $0$ lambda-nodes only we have that
$x$ points to the last node in $[r,x[ \inter N^{\lambda}$ with order strictly greater than $\ord{x}$.

Hence if $x$ is a bound variable node then it is bound by the
last $\lambda$-node in $[r,x[$ with order strictly greater than
$\ord{x}$ and if $x$ is a free variable then it points to $r$ and
therefore all the $\lambda$-node in $]r,x[$ have order smaller than
$\ord{x}$. Thus $\tau(M)^*$ is incrementally-bound.

\end{proof}

\begin{theorem}[Safety and P-incremental justification]
\label{thm:safeincrejust_pcf} In \pcf:
\begin{enumerate}[(i)]
\item If $M$ is safe then $\sem{M}$ is P-incrementally justified;
\item if $M$ is a closed term and $\sem{M}$ is
  P-incrementally justified then $\etanf{\betanf{M}}^*$ is safe.
\end{enumerate}
\end{theorem}
\begin{proof}
\noindent(i)
This is proved in  \cite[Theorem 4.2.10]{blumtransfer}.

\noindent(ii) Suppose $M$ is a closed \pcf\ term with a P-incrementally justified strategy denotation. By Proposition \ref{prop:incrbound_imp_incrjustified_pcf}(ii), $\tau(\betanf{M})^* = \tau(\etanf{\betanf{M}}^*)$ is incrementally-bound.

Lemma 4.1.6(ii) from \cite{blumtransfer} states that in the simply typed $\lambda$ calculus, if $M$ is closed and $\tau(M)$ is incrementally-bound then the $\etanf{M}$ is safe.
This lemma remains valid for infinite closed \pcf\ terms in normal form.

Thus $\etanf{\etanf{\betanf{M}}^*} = \etanf{\betanf{M}}^*$ is safe.
\end{proof}


We write \pcf' to denote the language obtained by extending \pcf\
with the $\pcfcase_k$ construct (see \cite{Abr02}).
The $\pcfcase_k$ construct is the obvious generalisation of the
conditional operator \pcfcond\ to $k$ branches instead of $2$. All the results obtained so far concerning Safe \pcf\ (including those
cited from \cite{blumtransfer}) can clearly be transposed to \pcf'.

The previous theorem leads to the following definability result for safe \pcf':
\begin{proposition}[Definability for safe \pcf' terms]
\label{prop:safetydefinability}
Let $\sigma$ be a well-bracketed innocent
P-incrementally-justified strategy with finite view function defined on the game $A$. There exists a \emph{safe} closed PCF' term $\vdash_s M : A$ in $\eta$-long normal form such that:
$$ \sem{M_\sigma} = \sigma $$
\end{proposition}
\begin{proof}
By the standard definability result for PCF', there is a closed term $\vdash N : A$ such that $\sem{N} = \sigma$.
Take $M_\sigma = \etanf{\betanf{N}}^*$.
Clearly $\sem{ M_\sigma} = \sem{N} = \sigma$, and by Theorem \ref{thm:safeincrejust_pcf}(ii), $M_\sigma$ is safe.
\end{proof}


\subsection{Composition of P-ij startegies}

Let $f:A\rightarrow B$ and $g:B\rightarrow C$ be two innocent well-bracketed and P-incrementally-justified strategies with finite view function.
We would like to prove that $f;g$ is also P-incrementally-justified.

By the definability result, there are two closed terms (in $\eta$-nf) $\vdash M_f :A\rightarrow B$  and $\vdash M_g :A\rightarrow B$ such that $\sem{M_f} = f$
and $\sem{M_f} = g$.

We define the term $M_{f;g} = \lambda x . M_g (M_f x)$. Clearly we have $\sem{M_{f;g}} = \sem{M_f} ; \sem{M_g} = f;g$. By Theorem \ref{thm:safeincrejust_pcf}, we have that $f;g$ is P-incrementally justified if and only if $\etanf{\betanf{M_{f;g}}}^*$ is safe. However this condition is not satisfactory in the sense it relies on some (syntactic) composition of $f$ and $g$. It would be better to obtain a condition on the types $A$, $B$, $C$ for instance, or on the strategy $f$ and $g$.

In the following, we will derive a sufficient condition for the composition of $f$ and $g$ to be P-incrementally justified.


Suppose $A=I$, where $I$ denotes the empty arena, then $f;g = \sem{M_g M_f}$ and since $M_g$ and $M_f$ are safe, $M_g M_f$ is semi-safe therefore $f;g$ is P-incrementally-justified.
If $B=I$ then $f;g = g$ which is P-incrementally-justified.
If $C=I$ then $f;g = \{ \epsilon \}$.

We now assume that $A$,$B$ and $C$ are not the empty arena. We have $B=(B_1,\ldots,B_l,o)$ and $C=(C_1,\ldots,C_k,o)$ for some $l,k\geq 0$. The term $M_f$ and $M_g$, being in $\eta$-nf, are of the following forms:
\begin{eqnarray*}
\vdash M_f &=& \lambda x^A \varphi_1^{B_1} \ldots \varphi_l^{B_l} . N_f^o\\
\vdash  M_g &=& \lambda y^B \phi_1^{C_1} \ldots \phi_k^{C_k} . N_g^o
\end{eqnarray*}
for some distinct variables $x,y,\varphi_1, \dots \varphi_l, \phi_1, \dots \phi_k$ and
terms $N_f$ and $N_g$ in $\eta$-nf:
\begin{eqnarray*}
x:A, \varphi_1:B_1, \dots, \varphi_l:B_l &\vdash& N_f :o \\
y:B, \phi_1:C_1, \dots, \phi_l:C_l &\vdash& N_g :o
\end{eqnarray*}


 

Unfortunately, the term $M_{f;g}$ is not necessarily safe even if $M_f$ and $M_g$ are. Take $M_f = \lambda x^o z^o.x$ and
$M_g = \lambda y^{(o,o)} . y a$ for some constant $a\in \Sigma$.
Then $\lambda x:A . M_g (M_f x) = \lambda x . (\lambda y . y a) ( \underline{(\lambda x z.x) x} )$ which is unsafe because of the underlined subterm. Therefore we cannot conclude at this point that $f;g$ is P-incrementally-bound.

However we have:
\begin{align*}
f;g &= \sem{\lambda x . M_g (M_f x)} \\
 &= \sem{\lambda x . (\lambda \phi_1\ldots \phi_k . N_g) [(M_f x) / y]} \\
&= \sem{\lambda x \phi_1 \dots \phi_k. N_g [(M_f x) / y]}
& \mbox{($x\neq\phi_i$ for all $i$)}.
\end{align*}

So if the term  $\lambda x \phi_1 \dots \phi_k. N_g [(M_f x) / y]$ is safe then $f;g$ is P-incrementally justified.

\subsubsection{A sufficient condition}
\begin{lemma}
Suppose that $\Gamma,y \vdash M$ is a safe term in $\eta$-nf and $\Gamma \vdash R$ is an almost safe application. Let $N$ denote the set of nodes of the computation tree $\tau(M)$. We have:
\begin{align*}
\Gamma \vdash M[R/y] \mbox{ safe } 
\iff& \forall n_y \in N_{fv} \mbox{ labelled $y$}. \\
  &\forall x \in fv(R) . \forall m \in N_{\lambda} \inter ]r,n_y] : \ord{m} \leq \ord{x}
\end{align*}
\end{lemma}
\begin{proof}
Since $M$ is in $\eta$-nf, all the application to the variable $y$ are total (i.e.~of the form $y P_1 \ldots P_l :o$). Hence after substituting the safe term $N$ for $y$ in $M$, the only possible cause of unsafety is when
some variable free in $N$ becomes not safely bound in $\tau(M)$.
\end{proof}

Let us apply the previous lemma with $R= M_f x$. If the condition in the right-hand side of the equivalence in the lemma is verified then the term  $\lambda x \phi_1 \dots \phi_k. N_g [(M_f x) / y]$ is safe which in turn implies that $f;g$ is P-incrementally justified.

This gives us a sufficient condition, however it is not necessary since the term $N_g[(M_f x)/y]$ is not in $\beta\eta$-normal form: we could have $\etabetanf{N_g[(M_f x) /y]}$ safe with $N_g[(M_f x) /y]$ unsafe.

\subsubsection{A simpler sufficient condition}
% The following commented lemma has been simplified into
% the lemma following the commented text using the 
% substitution lemma for the safe lambda calculus
%
%\begin{lemma}
%If $y:B, \Sigma \vdash N : T$ is a safe term in $\eta$-nf
%and $\vdash M : A \rightarrow B$ is a safe term with $\ord{A} \geq \ord{B}$
%then $x:A, \Sigma \vdash N[(M x)/y] :T$ is also safe.
%\end{lemma}
%\begin{proof}
%By induction on the $\eta$-normal structure of $N$.
%
%Suppose $N= y N_1 \dots N_l :o$ where  for $1\leq i \leq l$, $y:B, \Sigma \vdash N_i$ is safe.
%By the induction hypothesis, $x:A, \Sigma \vdash N_i[(M x)/y]$ is safe for $1\leq i \leq l$ and since $M$ is safe, using the (app) rule we have that
%$M x N_1[(M x)/y] \dots N_l[(M x)/y] = N[(M x)/y]$ is safe.
%
%The case $N= z N_1 \dots N_l :o$ for $z\neq y$ is treated identically.
%
%Suppose $N =\lambda \overline{\xi} . S$ with $S:o$. We suppose that
%$y\notin  \overline{\xi}$ and $y\in fv(S)$ (otherwise no substitution happens
%and the proof becomes trivial).
%By the induction hypothesis
%$x:A,\Sigma, \overline{\xi} \vdash S [(M x)/y]$ is safe.
%By safety of $N$, since $y$ occurs free in $S$, we have
%$\ord{C} \leq \ord{y}$, moreover by assumption, $\ord{y} = \ord{B} \leq \ord{A} = \ord{x}$ thus $\ord{C} \leq \ord{x}$ which permits us to use the (abs) rule
%to form the safe term $x:A,\Sigma \vdash \lambda \overline{\xi} . S [(M x)/y]$.
%\end{proof}

\begin{lemma}
If $y:B, \Sigma \vdash N : T$ and $\vdash M : A \rightarrow B$ 
are safe terms with $\ord{A} \geq \ord{B}$
then $x:A, \Sigma \vdash N[(M x)/y] :T$ is also safe.
\end{lemma}
\begin{proof}
Since $\ord{x} = \ord{A} \geq \ord{B} = \ord{M x}$, we can use the application 
rule of the safe lambda calculus to form the safe term $x:A \vdash M x$.
Using the substitution lemma we have that $N[(M x)/y]$ is safe.
\end{proof}

From this lemma we obtain that $\ord{A}\geq\ord{B}$ is
a sufficient condition for $f;g$ to be P-incrementally justified.
Since if $\ord{A}\geq\ord{B}$ then the previous lemma implies that $\vdash \lambda x \phi_1 \dots \phi_k. N_g [(M_f x) / y]$
is safe and therefore $f;g = \sem{\vdash \lambda x \phi_1 \dots \phi_k. N_g [(M_f x) / y]}$ is P-incrementally justified.


Of course this condition is not necessary. For instance take $A=o$, $B=(o,o)$, $C=(o,o)$ and consider the two safe terms $M_f = \lambda x u.u$ and $M_g = \lambda y . y a$ for $x,u:o$, $y:B$ and constants $a:o$. Since $M_{f;g} = \lambda x . a$ is safe, $f;g$ is P-incrementally justified although $\ord{A} < \ord{B}$.





\subsection{Counter-example (two P-ij strategies whose composition is not P-ij)}
\subsubsection{First attempt:}

Take $A=o$, $B=(o,o)$, $C=o$. Let $x,u,v:o$, $y:B$ be variables and $\varphi:((o,o),o)$ and $a:o$ be $\Sigma$-constants.

Remark that we use of a constant $\varphi$ of order greater than $2$ therefore we are not working in the context of the simply typed lambda calculus, nor \pcf.

Take the two safe terms $\vdash  M_f = \lambda xv.x$ and $\vdash M_g = \lambda y . \varphi (\lambda u . y a)$.
The $\eta\beta$-nf of $M_{f;g}$ is $\vdash \lambda x . \varphi (\underline{\lambda u . x})$ which is unsafe because of the underlined term. It is then tempting to use
Theorem \ref{thm:safeincrejust}(ii) (or Theorem \ref{thm:safeincrejust_pcf}(ii) in the case of \pcf) to conclude that
$f;g$ is not P-incrementally justified. However as we noted before, $M_g$ contains an order $2$ constants($\varphi$) therfore it is not a valid simply typed $\lambda$-term nor a \pcf-term hence we cannot use these theorems.

\subsubsection{Second attempt:}
The previous example can be easily changed into a working counter-example: we just need to elevate $\varphi$ from the status of constant to variable.

We then have $A=o$, $B=(o,o)$, $C=(((o,o),o),o)$, variables
$x,u,v:o$, $y:B$ and $\varphi:((o,o),o)$ and the $\Sigma$-constant $a:o$.

Take the two safe terms $\vdash  M_f = \lambda xv.x$ and  $\vdash M_g = \lambda y \varphi. \varphi (\lambda u . y a)$.
The $\eta\beta$-nf of $M_{f;g}$ is $\vdash \lambda x \varphi. \varphi (\underline{\lambda u . x})$ which is unsafe because of the underlined term, thus by Theorem \ref{thm:safeincrejust}(ii), $f;g$ is not P-incrementally justified. The following diagram illustrates  a play of $f;g$ that is not P-ij.

\begingroup
\def\sigcol#1{{\color{gray} #1}}
\def\mucol#1{{\color{red} #1}}
\def\sigmucol#1{{\color{black} #1}}
$$
\begin{array}{ccccccccc}
A &  & \multicolumn{2}{c}{B} && \multicolumn{4}{c}{C}\\
\cline{1-1} \cline{3-4} \cline{6-9}
o & \stackrel{\sigcol f}\longrightarrow & o, & o & \stackrel{\mucol g}\longrightarrow & ((o, &o),& o),& o \\ \\
&&&&&&&&\rnode{n0}{\lambda x \varphi \omove  \mucol {\lambda y \varphi}}\\
&&&&&&&\rnode{n1}{\varphi  \pmove \mucol \varphi}\\
&&&&&&\rnode{n2}{\lambda u \omove  \mucol {\lambda u}} \\
&&&  \rnode{n3}{\omove \sigcol {\lambda v} \pmove \mucol y} \\
\rnode{n4}{x \pmove \sigcol x}
\end{array}
\ncarc[arcangleA=20,arcangleB=20]{->}{n4}{n0}
\ncarc[arcangleA=30,arcangleB=20,linecolor=red]{->}{n2}{n1}
\ncarc[arcangleA=30,arcangleB=20,linecolor=red]{->}{n1}{n0}
\ncarc[arcangleA=20,arcangleB=20,linecolor=red]{->}{n3}{n0}
\ncarc[arcangleA=20,arcangleB=20,linecolor=gray]{->}{n4}{n3}
$$
\endgroup

\subsubsection{Another counter-example where $\ord{B} = \ord{C}$}

Let $A=o$, $B=C=(((o,o),o),o)$ and let $x:A$, $y:B$, $u:o$, $v,\varphi:((o,o),o)$
and $g:(o,o)$ be variables and  $a:o$ be a $\Sigma$-constant. Take the two safe terms $\vdash  M_f = \lambda x v.x$ and $\vdash M_g = \lambda y \varphi. \varphi (\lambda u . y (\lambda g. a))$.
The $\eta\beta$-nf of $M_{f;g}$ is $\vdash \lambda x \varphi. \varphi (\underline{\lambda u . x})$ which is unsafe because of the underlined term, so
$f;g$ is not P-incrementally justified.
 
\bibliographystyle{plain}
\bibliography{../bib/higherorder,../bib/gamesem,../bib/lambdacalculus}


\section{P-ij and IA}
$var = acc \times exp = com^{\omega}\times exp$

Any strategy on the game $I \rightarrow !var$ is P-ij since there is no P-question in the arena $var$.


\end{document}
