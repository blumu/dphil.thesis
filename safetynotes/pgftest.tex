\input{preamble.tex}

\usepackage[pgf]{pstring}

\begin{document}
%
%\tikz[baseline=(ref.base)]{
%    \path[anchor = base west] node[nn] (ref) {} ; }
%
%\def\toto{\path[anchor = base west] node[nn] (ref) {} ;}
%
%\tikz[baseline=(ref.base)]{ \toto
%     }   

\tikz[baseline]{\path[anchor = base west] ;}

\edef\TheAtCode{\the\catcode`\@}
\catcode`\@=11

    \def\tutu{ \path[anchor = base west] }
    \def\toto{ \@ifnextchar\@nil{\@gobble}{} }
    \def\ttikz{\tikz[baseline]}
    %\def\tikzspecif{ \expandafter\tutu \toto\@nil ; }
\begin{pgfpicture}
%\tutu \toto\@nil ;
\end{pgfpicture}
%\def\path{$\backslash$path} ***\tikzspecif***

\catcode`\@=\TheAtCode\relax



\def\pstr#1{\begin{pgfpicture}%
  \pgfsetbaseline{0pt}%
  \pgfsetshapeminwidth{0cm}%
  \pgfsetshapeminheight{0cm}%
  \pgfsetshapeinnerxsep{1pt}%
  \pgfsetarrows{-stealth}%
  \pgfsetfillcolor{red!60}%
  \pgfnode{rectangle}{base west}{}{ref}{\pgfusepath{fill}}% add the reference node for the alignment at the base of the nodes
  #1%
\end{pgfpicture}%
}

\def\nd(#1)#2#3{
  \pgfnode{rectangle}{base west}{\color{white}$#2$}{#1}{\pgfusepath{fill}}
  \pgftransformshift{\pgfpointanchor{#1}{base east}}
  \pgfnode{rectangle}{base west}{\color{white}$#3$}{#1t}{\pgfusepath{fill}}
  \pgftransformshift{\pgfpointanchor{#1t}{base east}}   
}

%\def\lnk#1#2#3#4{\draw[line width=0.3pt,arrows=-stealth](#2.120 )  .. controls +(120:#1) and +(60:#1) .. node[linklabel] {#4} (#3.north) }

\def\lnkb#1#2#3#4{
\count255 = 180 \advance \count255 by -#1
\advance \count255 by #1
\advance \count255 by -180
\def\u{ \number\count255 }
%\path[line width=0.3pt,arrows=-stealth] ([xshift=-0.5pt] #2.north)  edge[out=\number\count255,in=#1] node[linklabel] {#4} (#3.north);
\def\angleB{#1}
\def\angleA{130} %\count255=180 \advance \count255 by -\angleB}
\def\ptA{\pgfpointanchor{#2}{north}}
\def\ptB{\pgfpointanchor{#3}{north}}
\def\bendpt{
\pgfpointintersectionoflines
{\ptA}{\pgfpointadd{\ptA}{\pgfpointpolar{\angleA}{1cm}}}
{\ptB}{\pgfpointadd{\ptB}{\pgfpointpolar{\angleB}{1cm}}}}
\pgfpathmoveto{\ptA}
\pgfpathparabola{\pgfpointdiff{\ptA}{\bendpt}}{\pgfpointdiff{\bendpt}{\ptB}}
\pgfpathmoveto{\ptA}
\pgflineto{\bendpt}
\pgflineto{\ptB}
\color{orange}
\pgfusepath{stroke}
 }

sequence
\pstr{$t = \lambda \cdot$
\nd(app){@}{\cdot} sss
\nd(ly){\lambda y}{\ldots}
\nd(y){y}{\cdot}
\nd(lx){\lambda \overline{x}}{\ldots}
\nd(x){x_i}{\cdot}
\nd(leta){\lambda \overline{\eta_i} }{\ldots};
\lnkb{35}{y}{ly}{\tiny 1};
\lnkb{38}{lx}{app}{\tiny 1};
\lnkb{30}{x}{lx}{\tiny i};
\lnkb{40}{leta}{y}{\tiny i};
}
is

%\Pstr{ }
{
%\lambda  \cdot
%(app){@}{\cdot}
%(ly){\lambda y}{\ldots}
%(y-ly,35,{\tiny 1}){y}{\cdot}
%(lx-app,38,{\tiny 1}){\lambda \overline{x}}{\ldots}
%(x-lx,30,{\tiny 1}){x_i}{\cdot}
%(leta-y,40,{\tiny 1}){\lambda \overline{\eta_i} }{\ldots}
}

%t= \pstr{
%\nd(n){\lambda f z}{}
%\nd(n2){@}{}
%\nd(n3){\lambda g x}{}
%\nd(n4){f^{[1]}}{}
%\nd(n5){\lambda^{[2]}}{}
%\nd(n6){x}{}
%\nd(n7){\lambda^{[3]}}{}
%\nd(n8){f^{[4]}}{}
%\nd(n9){\lambda^{[5]}}{}
%\nd(n10){z}{};
%%\lnk{5pt}{n3}{n2}{};
%%\lnk{10pt}{n4}{n}{};
%%\lnk{5pt}{n5}{n4}{};
%%\lnk{5mm}{n6}{n3}{};
%%\lnk{5mm}{n7}{n2}{};
%%\lnk{18pt}{n8}{n}{};
%%\lnk{5pt}{n9}{n8}{};
%%\lnk{25pt}{n10}{n}{};
%\lnkb{60}{n3}{n2}{};
%\lnkb{45}{n4}{n}{};
%\lnkb{45}{n5}{n4}{};
%\lnkb{45}{n6}{n3}{};
%\lnkb{35}{n7}{n2}{};
%\lnkb{35}{n8}{n}{};
%\lnkb{45}{n9}{n8}{};
%\lnkb{35}{n10}{n}{};
%%\draw [->] ([xshift=-0.5pt] n3.120 )  .. controls +(120:1mm) and +(60:1mm) .. ([xshift=0.5pt]n2.north);
%%\draw [->] ([xshift=-0.5pt]n4.north)  .. controls +(120:5mm) and +(60:5mm) .. ([xshift=0.5pt]n.north);
%%\draw [->] ([xshift=-0.5pt]n5.north)  .. controls +(120:5pt) and +(60:5pt) .. ([xshift=0.5pt]n4.north);
%%\draw [->] ([xshift=-0.5pt]n6.north)  .. controls +(120:5mm) and +(60:5mm) .. ([xshift=0.5pt]n3.north);
%%\draw [->] ([xshift=-0.5pt]n7.north)  .. controls +(120:5mm) and +(60:5mm) .. ([xshift=0.5pt]n2.north);
%%\draw [->] ([xshift=-0.5pt]n8.north)  .. controls +(120:5mm) and +(60:5mm) .. ([xshift=0.5pt]n.north);
%%\draw [->] ([xshift=-0.5pt]n9.north)  .. controls +(120:5pt) and +(60:5pt) .. ([xshift=0.5pt]n8.north);
%%\draw [->] ([xshift=-0.5pt]n10.north) .. controls +(120:20pt) and +(60:20pt) .. ([xshift=0.5pt]n.north);
%}



\end{document}
