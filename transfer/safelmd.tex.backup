\subsection{Homogenous type}
\label{sec:homotypes}

Let $Types$ be the set of simple types generated by the grammar $A
\, ::= \, o \; | \; A \funsp A$. Any type different from the base
type $o$ can be written $(A_1, \cdots, A_n, o)$ for some $n \geq 1$,
which is a shorthand for $A_1 \funsp \cdots \funsp A_n \funsp o$ (by
convention, $\rightarrow$ associates to the right).

We suppose that a ranking function has been defined: ${\sf rank} :
Types \funto (L, \leq)$ where $(L, \leq)$ is any linearly ordered
set. Possible candidates for the ranking function are:
\begin{itemize}
\item ${\sf order} : Types \funto (\nat,\leq)$ with $\order{o} = 0$
and $\order{A \funsp B} = \max(\order{A}+1, \order{B})$.
\item ${\sf height} : Types \funto (\nat,\leq)$ with $\height{o} = 0$
and $\height{A \funsp B} = 1 + \max(\height{A}, \height{B})$.
\item ${\sf nparam} : Types \funto (\nat,\leq)$ with $\nparam{o} = 0$
and $\nparam{A_1, \cdots, A_n} = n$.
\item ${\sf ordernp} : Types \funto (\nat \times \nat,\leq)$ with $ {\sf ordernp} (t)  = (\order{t}, \nparam{t})$ for $t \in Types$.
\end{itemize}


Following \cite{KNU02}, a type is rank-homogeneous if it is $o$ or
if it is $(A_1, \cdots, A_n, o)$ with the condition that $rank(A_1)
\geq rank(A_2)\geq \cdots \geq rank(A_n)$ and each $A_1$, \ldots,
$A_n$ is rank-homogeneous.



Suppose that $\overline{A_1}$, $\overline{A_2}$, \ldots,
$\overline{A_n}$ are $n$ lists of types, where $A_{ij}$ denotes the
$j^{th}$ type of list $\overline{A_i}$ and $l_i$ the size of
$\overline{A_i}$. Then the notation $A \; = \; (\overline{A_1} \, |
\, \cdots \, | \, \overline{A_r} \, | \, o)$ means that
\begin{itemize}
  \item $A$ is the type $(A_{11},A_{12},\cdots, A_{1l_1}, A_{21}, \cdots,A_{2l_2}, \cdots A_{n1},\cdots, A_{nl_n},o)$
  \item $\forall i: \forall u,v \in A_i : \rank u = \rank v $
  \item $\forall i,j . \forall u \in A_i . \forall v \in A_j . i<j \implies \rank u >
   \rank v $
\end{itemize}
Consequently, $A$ is rank-homogenous. This notation organises the
$A_{ij}$s into partitions according to their ranks. Suppose $B =
(\overline{B_1} \, | \, \cdots \, | \, \overline{B_m} \, | \, o)$.
We write $(\overline{A_1} \, | \, \cdots \, | \, \overline{A_n} \, |
\, {B})$ to mean
\[(\overline{A_1} \, | \, \cdots \, | \, \overline{A_n} \, | \,
\overline{B_1} \, | \, \cdots \, | \, \overline{B_m} \, | \, o).\]


\subsection{Rules }

These rules are a corrected version of
\cite{DBLP:conf/fossacs/AehligMO05}

 In the following we shall
consider terms-in-context $\seq{\Gamma}{M : A}$ of the simply-typed
$\lambda$-calculus. Let $\Delta$ be a simply-typed alphabet i.e.,
each symbol in $\Delta$ has a simple type. We write
$\terms{A}{\Delta}$ for the set of terms of type $A$ built up from
the set $\Delta$ understood as constant symbols, \emph{without}
using $\lambda$-abstraction.


The \textbfit{Safe $\lambda$-Calculus} is a sub-system of the
simply-typed $\lambda$-calculus. Typing judgements (or
terms-in-context) are of the form
\begin{equation}
\nonumber \seq{\overline{x_1}:\overline{A_1} \, | \, \cdots \, | \,
\overline{x_n} :  \overline{A_n}}{M : B}
\end{equation}
which is shorthand for $\seq{x_{11} : A_{11}, \cdots, x_{1r}:
A_{1r}, \cdots}{M : B}$. \emph{Valid typing judgements} of the
system are defined by induction over the following rules, where
$\Delta$ is a given homogeneously-typed alphabet:

\[ {    { \seq{\Sigma}{M:B} \qquad {\Sigma \subset \Delta} }
    \over
        { \seq{\Delta }{M : B}}
   }
   (\mbox{wk})
\]

\[  {
      { \seq{\Gamma}{M:B} \qquad \sigma(\Gamma) \hbox{ homogeneous} }
    \over
      { \seq{\sigma(\Gamma)}{M : B} }
    }
    (\mbox{perm})
\]


\[{ {b : o^r \rightarrow o \in \Sigma } \over {\seq{}{b : o^r \rightarrow o}}}  (\Sigma\mbox{-const})  \]

\[{ \over
{\seq{\overline{x_{ij}} : \overline{A_{ij}}\, }{x_{ij} :
A_{ij}}}}(\mbox{var})\]

\[
{ {\seq{\overline{x_1} : \overline{A_1}\, | \, \cdots\, | \,
\overline{x_{n+1}} : \overline{A_{n+1}}}{M : B}} \qquad
\ord{\overline{A_{n+1}}} \geq \ord{B} \over {\seq{\overline{x_1} :
\overline{A_1}\, | \, \cdots\, | \, \overline{x_{n}} :
\overline{A_{n}}}{\lterm{\overline{x_{n+1}} : \overline{A_{n+1}}}{M}
: (\overline{A_{n+1}} \, | \, B)}} } (\mbox{$\lambda$-abs})\]

\[ {{\seq{\Gamma}{M : (\overline{B_1} \, | \, \cdots \, | \, \overline{B_m} \, | \, o)} \qquad
\seq{\Gamma}{N_1 : B_{11}} \quad \cdots \quad \seq{\Gamma}{N_{l} : B_{1l}} \qquad l = |\overline{B_1}|
}
\over{ \seq{\Gamma}{M N_1 \cdots N_{l_1} :
(\overline{B_2} \, | \, \cdots \, | \, \overline{B_m} \, | \, o)}}}
(\mbox{app})\]


\[ {{\seq{\Gamma}{M : (\overline{B_1} \, | \, \cdots \, | \, \overline{B_m} \, | \, o)} \qquad
\seq{\Gamma}{N_1 : B_{11}} \quad \cdots \quad \seq{\Gamma}{N_{l} : B_{1l}} \qquad l < |\overline{B_1}|
}
\over{ \seq{\Gamma}{M N_1 \cdots N_{l_1} :
(\overline{B_2} \, | \, \cdots \, | \, \overline{B_m} \, | \, o)}}}
(\mbox{app+})\]

where $\overline{B_1} = B_{11}, \ldots, B_{1l},\overline{B}$ with the condition that every variable in $\Sigma$ has an order greater than $\ord{\overline{B_1}}$.
